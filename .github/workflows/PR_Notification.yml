name: PR Notifications
on:
  pull_request:
    types: [opened, ready_for_review, review_requested]
jobs:
  notify_slack:
    runs-on: ubuntu-latest
    steps:
      - name: Get PR reviewers
        id: get-reviewers
        run: |
          reviewers=$(gh pr view ${{ github.event.pull_request.number }} --json reviewers -q '.reviewers[].login' | tr '\n' ',' | sed 's/,$//')
          echo "reviewers=$reviewers" >> $GITHUB_OUTPUT
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Slack Notification
        uses: 8398a7/action-slack@v3
        with:
          status: custom
          custom_payload: |
            {
              "attachments": [{
                "title": "ğŸ”¥ \"${{ github.event.pull_request.title }}\"ì— ëŒ€í•œ pull requestê°€ ìƒì„± ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ”¥",
                "text": "PR ë¸Œëœì¹˜ëŠ” \"${{ github.event.pull_request.head.ref }}\" â¡ï¸ ğŸš¨ \"${{ github.event.pull_request.base.ref }}\" ğŸš¨ ì…ë‹ˆë‹¤.\nğŸ™Œ  @${{ steps.get-reviewers.outputs.reviewers != '' && format('{0}', steps.get-reviewers.outputs.reviewers) ì˜ ë¦¬ë·°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”! ë‹¬ë ¤ì˜¤ì‹¤ê±°ì£ ?" || 'ì•„ì§ ì§€ì •ë˜ì§€ ì•ŠìŒ' }},
                "footer": "GitHub Actions",
                "footer_icon": "https://github.githubassets.com/favicon.ico",
                "ts": "${{ github.event.pull_request.created_at }}"
              }]
            }
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
