name: PR Notifications
on:
  pull_request:
    types: [opened, ready_for_review, review_requested]
jobs:
  notify_slack:
    runs-on: ubuntu-latest
    steps:
      - name: Get PR reviewers
        id: get-reviewers
        run: |
          reviewers=$(gh pr view ${{ github.event.pull_request.number }} --json reviewers -q '.reviewers[].login' | tr '\n' ',' | sed 's/,$//')
          echo "reviewers=$reviewers" >> $GITHUB_OUTPUT
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Slack Notification
        uses: 8398a7/action-slack@v3
        with:
          status: custom
          custom_payload: |
            {
              "attachments": [{
                "title": "🔥 \"${{ github.event.pull_request.title }}\"에 대한 pull request가 생성 되었습니다. 🔥",
                "text": "PR 브랜치는 \"${{ github.event.pull_request.head.ref }}\" ➡️ 🚨 \"${{ github.event.pull_request.base.ref }}\" 🚨 입니다.\n🙌  @${{ steps.get-reviewers.outputs.reviewers != '' && format('{0}', steps.get-reviewers.outputs.reviewers) 의 리뷰를 기다리고 있어요! 달려오실거죠?" || '아직 지정되지 않음' }},
                "footer": "GitHub Actions",
                "footer_icon": "https://github.githubassets.com/favicon.ico",
                "ts": "${{ github.event.pull_request.created_at }}"
              }]
            }
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
